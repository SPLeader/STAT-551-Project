---
title: "Final Report Draft"
author: "Sean Leader // William Medwid // Vanessa Veto // Jose Mierzejewski"
format: 
  html:
    code-fold: true
    code-line-numbers: true
    code-tools: true
    self-contained: true
    theme: cosmo
editor: visual
execute:
  message: false
  include: false
  echo: false
---

```{r}
library(tidyverse)
library(here)
library(lubridate)
library(knitr)
```

```{r}
aqi <- read_csv(here("Project Data",
                     "Combined",
                     "aqi_ozone_all_years_prediction.csv"))
```

```{r}
aqi
```



# Introduction

- Mention that we removed all ozone measurements and previous-day AQI from the dataset such that if for some reason ozone measurements were not taken, you could still predict the ozone AQI.

# Exploratory Data Analysis

- Insert graphs from phase 2 here

## AQI

### Overall distribution of AQI
```{r, fig.cap = "Figure 1. Overall distribution of AQI", include = TRUE, message = FALSE}
ggplot(aqi, aes(AQI_next_day, fill = cut(AQI_next_day, 100))) +
  geom_histogram(show.legend = FALSE) +
  scale_fill_discrete(h = c(200, 10), c = 200, l = 70) + 
  theme_bw() + 
  labs(y = "",
       x = "AQI") 
```

```{r, fig.cap = "Table 1. Summary statistics of AQI", include = TRUE}
aqi %>% 
  summarise(Mean = round(mean(AQI_next_day), 2),
            SD = round(sd(AQI_next_day), 2),
            Median = median(AQI_next_day),
            IQR = IQR(AQI_next_day)) %>%
  kable()
```


Overall, the distribution of AQI scores is single-peaked and right-skewed, with a median next-day AQI of 44 and an interquartile range of 30. The graph is likely right-skewed because AQI is bounded on the lower end by 0, but has no upper limit. 

<br />
<br />

### Overall distribution of AQI by month 
```{r, fig.cap = "Figure 2. Distribution of AQI by month", include = TRUE}
aqi %>%
  mutate(Month = factor(month(Date, label = TRUE))) %>%
  ggplot(aes(x = Month, y = AQI_next_day, fill = Month)) + 
  geom_boxplot() + 
  theme_bw() + 
  theme(legend.position = "None") + 
        #axis.title.y = element_text(angle = 0, vjust = 0.5)) +
  labs(y = "") +
  scale_fill_manual(values = c("#034E7B", "#0570B0", "#3690C0", "#74A9CF", "#A6BDDB", "#D0D1E6",
                                          "#F1EEF6", "#D0D1E6", "#A6BDDB", "#74A9CF", "#3690C0", "#0570B0"))
```


### Correlations with predictors
```{r, fig.cap = "Figure 3. Predictor correlations with AQI, by min, mean, and max concentration", include = TRUE}
aqi %>% select(-Date, -County, -State, 
               -AQI, -AQI_cat, -max_ozone, 
               -mean_ozone, -min_ozone) %>%
  cor() %>% 
  data.frame() %>%
  select(AQI_next_day) %>% 
  mutate(variable = rownames(.),
         variable_category = str_replace(variable, ".+_", ""),
         variable_type = str_replace(variable, "_.+", "")) %>%
  filter(variable != "AQI_next_day") %>%
  rename("Correlation" = AQI_next_day) %>%
  ggplot(aes(x = factor(variable_category, 
                        levels = c("no2", "temp", "co", 
                                   "so2", "no", "wind", 
                                   "pressure", "humid")), y = Correlation, fill = variable_type)) + 
  geom_col(position = "dodge", width = 0.75) +
  theme_bw() +
  scale_fill_manual(values = c("#88CCEE", "#CC6677", "#DDCC77")) +
  labs(title = "Corrleation between predictors and AQI",
       y = "",
       x = "Predictor",
       fill = "")
```


## Walkability

# Model Results

## AQI

## Walkability

# Discussion

## AQI

## Walkability



